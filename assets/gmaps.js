var GMaps=function(a){"use strict";var b=function(b){var c=this;var d="position:absolute;display:none;min-width:100px;"+"background:white;list-style:none;padding:8px;box-shadow:2px 2px 6px #ccc";window.context_menu={};this.div=a(b.div)[0];this.div.style.width=this.div.clientWidth||b.width;this.div.style.height=this.div.clientHeight||b.height;this.controls=[];this.overlays=[];this.layers=[];this.markers=[];this.polylines=[];this.routes=[];this.polygons=[];this.infoWindow=null;this.overlay_div=null;this.zoom=b.zoom||15;var e;if(b.mapType){e=google.maps.MapTypeId[b.mapType.toUpperCase()]}else{e=google.maps.MapTypeId.ROADMAP}var f=new google.maps.LatLng(b.lat,b.lng);delete b.lat;delete b.lng;delete b.mapType;delete b.width;delete b.height;var g={zoom:this.zoom,center:f,mapTypeId:e};var h=a.extend(g,b);this.map=new google.maps.Map(this.div,h);var i=function(b,d){var e="";var f=window.context_menu[b];for(var g in f){if(f.hasOwnProperty(g)){var h=f[g];e+='<li><a id="'+b+"_"+g+'" href="#">'+h.title+"</a></li>"}}var i=a("#gmaps_context_menu");i.html(e);i.undelegate();i.delegate("li a","click",function(e){e.preventDefault();f[a(this).attr("id").replace(b+"_","")].action.call(c,d);c.hideContextMenu()});var j=a(c.div).offset().left+d.pixel.x-15;var k=a(c.div).offset().top+d.pixel.y-15;i.css({left:j,top:k}).fadeIn(200)};var j=function(a,b){if(a==="marker"){b.pixel={};var d=new google.maps.OverlayView;d.setMap(c.map);d.draw=function(){var c=d.getProjection();var e=b.marker.getPosition();b.pixel=c.fromLatLngToContainerPixel(e);i(a,b)}}else{i(a,b)}};this.setContextMenu=function(b){window.context_menu[b.control]={};var c='<ul id="gmaps_context_menu" style="'+d+'"></ul>';for(var e in b.options){if(b.options.hasOwnProperty(e)){var f=b.options[e];window.context_menu[b.control][f.name]={title:f.title,action:f.action}}}a("body").append(c);a("#gmaps_context_menu").mouseleave(function(){a(this).delay(100).fadeOut(200)})};this.hideContextMenu=function(){a("#gmaps_context_menu").fadeOut(200)};var k=["bounds_changed","center_changed","click","dblclick","drag","dragend","dragstart","idle","maptypeid_changed","projection_changed","resize","tilesloaded","zoom_changed"];var l=["mousemove","mouseout","mouseover"];for(var m=0;m<k.length;m++){(function(a,d){google.maps.event.addListener(a,d,function(a){if(b[d])b[d].apply(this,[a]);c.hideContextMenu()})})(this.map,k[m])}for(var m=0;m<l.length;m++){(function(a,c){google.maps.event.addListener(a,c,function(a){if(b[c])b[c].apply(this,[a])})})(this.map,l[m])}google.maps.event.addListener(this.map,"rightclick",function(a){if(b.rightclick){b.rightclick.apply(this,[a])}j("map",a)});this.refresh=function(){google.maps.event.trigger(this.map,"resize")};this.fitZoom=function(){var a=[];var b=this.markers.length;for(var c=0;c<b;c++){a.push(this.markers[c].getPosition())}this.fitBounds(a)};this.fitBounds=function(a){var b=a.length;var c=new google.maps.LatLngBounds;for(var d=0;d<b;d++){c.extend(a[d])}this.map.fitBounds(c)};this.setCenter=function(a,b,c){this.map.panTo(new google.maps.LatLng(a,b));if(c){c()}};this.getCenter=function(){return this.map.getCenter()};this.getDiv=function(){return this.div};this.setZoom=function(a){this.map.setZoom(a)};this.zoomIn=function(a){this.map.setZoom(this.map.getZoom()+a)};this.zoomOut=function(a){this.map.setZoom(this.map.getZoom()-a)};this.createControl=function(b){b.style.cursor="pointer";b.style.fontFamily="Arial, sans-serif";b.style.fontSize="13px";b.style.boxShadow="rgba(0, 0, 0, 0.398438) 0px 2px 4px";var c=a("<div></div>");c.css(b.style);c.text(b.text);var d=c[0];for(var e in b.events){(function(a,c){google.maps.event.addDomListener(a,c,function(){b.events[c].apply(this,[this])})})(d,e)}d.index=1;return d};this.addControl=function(a){var b=google.maps.ControlPosition[a.position.toUpperCase()];delete a.position;var c=this.createControl(a);this.controls.push(c);this.map.controls[b].push(c);return c};this.createMarker=function(b){if(b.lat&&b.lng){var c=this;var d=b.details;var e=b.fences;var f=b.outside;var g={position:new google.maps.LatLng(b.lat,b.lng),map:null};delete b.lat;delete b.lng;delete b.fences;delete b.outside;var h=a.extend(g,b);var i=new google.maps.Marker(h);i.fences=e;if(b.infoWindow){i.infoWindow=new google.maps.InfoWindow(b.infoWindow);var j=["closeclick","content_changed","domready","position_changed","zindex_changed"];for(var k=0;k<j.length;k++){(function(a,c){google.maps.event.addListener(a,c,function(a){if(b.infoWindow[c])b.infoWindow[c].apply(this,[a])})})(i.infoWindow,j[k])}}var l=["drag","dragstart","mouseout","mouseover","mouseup","position_changed"];for(var k=0;k<l.length;k++){(function(a,c){google.maps.event.addListener(a,c,function(){if(b[c])b[c].apply(this,[this])})})(i,l[k])}google.maps.event.addListener(i,"click",function(){this.details=d;if(b.click){b.click.apply(this,[this])}if(i.infoWindow){c.hideInfoWindows();i.infoWindow.open(c.map,i)}});if(b.dragend||i.fences){google.maps.event.addListener(i,"dragend",function(){if(b.dragend){b.dragend.apply(this,[this])}if(i.fences){c.checkMarkerGeofence(i,function(a,b){f(a,b)})}})}return i}else{throw"No latitude or longitude defined"}};this.addMarker=function(a){if(a.lat&&a.lng){var b=this.createMarker(a);b.setMap(this.map);this.markers.push(b);return b}else{throw"No latitude or longitude defined"}};this.addMarkers=function(a){for(var b=0,c;c=a[b];b++){this.addMarker(c)}return this.markers};this.hideInfoWindows=function(){for(var a=0,b;b=this.markers[a];a++){if(b.infoWindow){b.infoWindow.close()}}};this.removeMarkers=function(){for(var a=0,b;b=this.markers[a];a++){b.setMap(null)}this.markers=[]};this.drawOverlay=function(b){var d=new google.maps.OverlayView;d.setMap(c.map);d.onAdd=function(){var a=document.createElement("div");a.style.borderStyle="none";a.style.borderWidth="0px";a.style.position="absolute";a.innerHTML=b.content;c.overlay_div=a;var d=this.getPanes();if(!b.layer){b.layer="overlayLayer"}var e=d[b.layer];e.appendChild(a)};d.draw=function(){var d=this.getProjection();var e=d.fromLatLngToDivPixel(new google.maps.LatLng(b.lat,b.lng));b.horizontalOffset=b.horizontalOffset||0;b.verticalOffset=b.verticalOffset||0;var f=c.overlay_div;var g=f.children;switch(b.verticalAlign){case"top":f.style.top=e.y-a(g).height()+b.verticalOffset+"px";break;default:case"middle":f.style.top=e.y-a(g).height()/2+b.verticalOffset+"px";break;case"bottom":f.style.top=e.y+b.verticalOffset+"px";break}switch(b.horizontalAlign){case"left":f.style.left=e.x-a(g).width()+b.horizontalOffset+"px";break;default:case"center":f.style.left=e.x-a(g).width()/2+b.horizontalOffset+"px";break;case"right":f.style.left=e.x+b.horizontalOffset+"px";break}};d.onRemove=function(){c.overlay_div.parentNode.removeChild(c.overlay_div);c.overlay_div=null};c.overlays.push(d);return d};this.removeOverlay=function(a){a.setMap(null)};this.removeOverlays=function(){for(var a=0,b;b=c.overlays[a];a++){b.setMap(null)}c.overlays=[]};this.drawPolyline=function(a){var b=[];var c=a.path;if(c.length){if(c[0][0]===undefined){b=c}else{for(var d=0,e;e=c[d];d++){b.push(new google.maps.LatLng(e[0],e[1]))}}}var f=new google.maps.Polyline({map:this.map,path:b,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});var g=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var h=0;h<g.length;h++){(function(b,c){google.maps.event.addListener(b,c,function(b){if(a[c])a[c].apply(this,[b])})})(f,g[h])}this.polylines.push(f);return f};this.drawCircle=function(b){b=a.extend({map:this.map,center:new google.maps.LatLng(b.lat,b.lng)},b);delete b.lat;delete b.lng;var c=new google.maps.Circle(b);var d=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var e=0;e<d.length;e++){(function(a,c){google.maps.event.addListener(a,c,function(a){if(b[c])b[c].apply(this,[a])})})(c,d[e])}return c};this.drawPolygon=function(b){function f(a){return new google.maps.LatLng(a[0],a[1])}b=a.extend({map:this.map},b);if(a.isArray(b.paths)){if(a.isArray(b.paths[0])){b.paths=a.map(b.paths,f)}}var c=new google.maps.Polygon(b);var d=["click","dblclick","mousedown","mousemove","mouseout","mouseover","mouseup","rightclick"];for(var e=0;e<d.length;e++){(function(a,c){google.maps.event.addListener(a,c,function(a){if(b[c])b[c].apply(this,[a])})})(c,d[e])}this.polygons.push(c);return c};this.getFromFusionTables=function(a){var b=a.events;delete a.events;var c=a;var d=new google.maps.FusionTablesLayer(c);for(var e in b){(function(a,c){google.maps.event.addListener(a,c,function(a){b[c].apply(this,[a])})})(d,e)}this.layers.push(d);return d};this.loadFromFusionTables=function(a){var b=this.getFromFusionTables(a);b.setMap(this.map);return b};this.getFromKML=function(a){var b=a.url;var c=a.events;delete a.url;delete a.events;var d=a;var e=new google.maps.KmlLayer(b,d);for(var f in c){(function(a,b){google.maps.event.addListener(a,b,function(a){c[b].apply(this,[a])})})(e,f)}this.layers.push(e);return e};this.loadFromKML=function(a){var b=this.getFromKML(a);b.setMap(this.map);return b};var n,o;this.getRoutes=function(b){switch(b.travelMode){case"bicycling":n=google.maps.TravelMode.BICYCLING;break;case"driving":n=google.maps.TravelMode.DRIVING;break;default:n=google.maps.TravelMode.WALKING;break}if(b.unitSystem==="imperial"){o=google.maps.UnitSystem.IMPERIAL}else{o=google.maps.UnitSystem.METRIC}var c={avoidHighways:false,avoidTolls:false,optimizeWaypoints:false,waypoints:[]};var d=a.extend(c,b);d.origin=new google.maps.LatLng(b.origin[0],b.origin[1]);d.destination=new google.maps.LatLng(b.destination[0],b.destination[1]);d.travelMode=n;d.unitSystem=o;delete d.callback;var e=this;var f=new google.maps.DirectionsService;f.route(d,function(a,c){if(c===google.maps.DirectionsStatus.OK){for(var d in a.routes){if(a.routes.hasOwnProperty(d)){e.routes.push(a.routes[d])}}}if(b.callback){b.callback(e.routes)}})};this.drawRoute=function(a){var b=this;this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(c){if(c.length>0){b.drawPolyline({path:c[c.length-1].overview_path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});if(a.callback){a.callback(c[c.length-1])}}}})};this.travelRoute=function(a){if(a.origin&&a.destination){this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(b){if(b.length>0&&a.step){var c=b[b.length-1];if(c.legs.length>0){var d=c.legs[0].steps;for(var e=0,f;f=d[e];e++){f.step_number=e;a.step(f)}}}}})}else if(a.route){if(a.route.legs.length>0){var b=a.route.legs[0].steps;for(var c=0,d;d=b[c];c++){d.step_number=c;a.step(d)}}}};this.drawSteppedRoute=function(a){if(a.origin&&a.destination){this.getRoutes({origin:a.origin,destination:a.destination,travelMode:a.travelMode,callback:function(b){if(b.length>0&&a.step){var d=b[b.length-1];if(d.legs.length>0){var e=d.legs[0].steps;for(var f=0,g;g=e[f];f++){g.step_number=f;c.drawPolyline({path:g.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.step(g)}}}}})}else if(a.route){if(a.route.legs.length>0){var b=a.route.legs[0].steps;for(var d=0,e;e=b[d];d++){e.step_number=d;c.drawPolyline({path:e.path,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight});a.step(e)}}}};this.checkGeofence=function(a,b,c){return c.containsLatLng(new google.maps.LatLng(a,b))};this.checkMarkerGeofence=function(a,b){if(a.fences){for(var d=0,e;e=a.fences[d];d++){var f=a.getPosition();if(!c.checkGeofence(f.lat(),f.lng(),e)){b(a,e)}}}}};b.Route=function(a){this.map=a.map;this.route=a.route;this.step_count=0;this.steps=this.route.legs[0].steps;this.steps_length=this.steps.length;this.polyline=this.map.drawPolyline({path:new google.maps.MVCArray,strokeColor:a.strokeColor,strokeOpacity:a.strokeOpacity,strokeWeight:a.strokeWeight}).getPath();this.back=function(){if(this.step_count>0){this.step_count--;var a=this.route.legs[0].steps[this.step_count].path;for(var b in a){if(a.hasOwnProperty(b)){this.polyline.pop()}}}};this.forward=function(){if(this.step_count<this.steps_length){var a=this.route.legs[0].steps[this.step_count].path;for(var b in a){if(a.hasOwnProperty(b)){this.polyline.push(a[b])}}this.step_count++}}};b.geolocate=function(a){if(navigator.geolocation){navigator.geolocation.getCurrentPosition(function(b){a.success(b);if(a.always){a.always()}},function(b){a.error(b);if(a.always){a.always()}},a.options)}else{a.not_supported();if(a.always){a.always()}}};b.geocode=function(a){this.geocoder=new google.maps.Geocoder;var b=a.callback;if(a.lat&&a.lng){a.latLng=new google.maps.LatLng(a.lat,a.lng)}delete a.lat;delete a.lng;delete a.callback;this.geocoder.geocode(a,function(a,c){b(a,c)})};b.staticMapURL=function(a){function n(a,b){if(a[0]==="#"){a=a.replace("#","0x");if(b){b=parseFloat(b);b=Math.min(1,Math.max(b,0));if(b===0){return"0x00000000"}b=(b*255).toString(16);if(b.length===1){b+=b}a=a.slice(0,8)+b}}return a}var b=[];var c;var d="http://maps.googleapis.com/maps/api/staticmap";if(a.url){d=a.url;delete a.url}d+="?";var e=a.markers;delete a.markers;if(!e&&a.marker){e=[a.marker];delete a.marker}var f=a.polyline;delete a.polyline;if(a.center){b.push("center="+a.center);delete a.center}else if(a.address){b.push("center="+a.address);delete a.address}else if(a.lat){b.push(["center=",a.lat,",",a.lng].join(""));delete a.lat;delete a.lng}else if(a.visible){var g=encodeURI(a.visible.join("|"));b.push("visible="+g)}var h=a.size;if(h){if(h.join){h=h.join("x")}delete a.size}else{h="630x300"}b.push("size="+h);if(!a.zoom){a.zoom=15}var i=a.hasOwnProperty("sensor")?!!a.sensor:true;delete a.sensor;b.push("sensor="+i);for(var j in a){if(a.hasOwnProperty(j)){b.push(j+"="+a[j])}}if(e){var k,l;for(var m=0;c=e[m];m++){k=[];if(c.size&&c.size!=="normal"){k.push("size:"+c.size)}else if(c.icon){k.push("icon:"+encodeURI(c.icon))}if(c.color){k.push("color:"+c.color.replace("#","0x"))}if(c.label){k.push("label:"+c.label[0].toUpperCase())}l=c.address?c.address:c.lat+","+c.lng;if(k.length||m===0){k.push(l);k=k.join("|");b.push("markers="+encodeURI(k))}else{k=b.pop()+encodeURI("|"+l);b.push(k)}}}if(f){c=f;f=[];if(c.strokeWeight){f.push("weight:"+parseInt(c.strokeWeight,10))}if(c.strokeColor){var o=n(c.strokeColor,c.strokeOpacity);f.push("color:"+o)}if(c.fillColor){var p=n(c.fillColor,c.fillOpacity);f.push("fillcolor:"+p)}var q=c.path;if(q.join){for(var r=0,s;s=q[r];r++){f.push(s.join(","))}}else{f.push("enc:"+q)}f=f.join("|");b.push("path="+encodeURI(f))}b=b.join("&");return d+b};if(!google.maps.Polygon.prototype.getBounds){google.maps.Polygon.prototype.getBounds=function(a){var b=new google.maps.LatLngBounds;var c=this.getPaths();var d;for(var e=0;e<c.getLength();e++){d=c.getAt(e);for(var f=0;f<d.getLength();f++){b.extend(d.getAt(f))}}return b}}google.maps.Polygon.prototype.containsLatLng=function(a){var b=this.getBounds();if(b!==null&&!b.contains(a)){return false}var c=false;var d=this.getPaths().getLength();for(var e=0;e<d;e++){var f=this.getPaths().getAt(e);var g=f.getLength();var h=g-1;for(var i=0;i<g;i++){var j=f.getAt(i);var k=f.getAt(h);if(j.lng()<a.lng()&&k.lng()>=a.lng()||k.lng()<a.lng()&&j.lng()>=a.lng()){if(j.lat()+(a.lng()-j.lng())/(k.lng()-j.lng())*(k.lat()-j.lat())<a.lat()){c=!c}}h=i}}return c};google.maps.LatLngBounds.prototype.containsLatLng=function(a){return this.contains(a)};google.maps.Marker.prototype.setFences=function(a){this.fences=a};google.maps.Marker.prototype.addFence=function(a){this.fences.push(a)};return b}(jQuery||$)
